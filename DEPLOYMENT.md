# Deployment Runbook

This project deploys a Vite React front-end to Netlify and Supabase Edge Functions for backend routines.

## Prerequisites

- Netlify CLI authenticated to the target team (`netlify login`).
- Supabase CLI logged in (`supabase login`) and pointed to the correct project (`supabase link --project-ref <project>`).
- Environment variables copied from `.env.example` into a local `.env`.
- `npm install` executed locally.

## Release pipeline

1. **Build the client**
   ```sh
   npm run build
   ```
2. **Deploy static assets to Netlify**
   ```sh
   netlify deploy --build --prod
   ```
   - Uses the `dist/` directory generated by Vite.
   - Ensure `NETLIFY_SITE_ID` and `NETLIFY_AUTH_TOKEN` are available to the CLI.
3. **Deploy Supabase functions**
   ```sh
   supabase functions deploy server
   supabase functions deploy send-email
   ```
   - The CLI bundles code, uploads to your Supabase project, and refreshes access tokens.
4. **Run post-deploy checks**
   ```sh
   ./scripts/test-backend.sh production
   ```
   - Executes smoke tests defined for critical backend endpoints.

## Rollback strategy

- **Netlify:** redeploy the prior build from the deploy history in the Netlify dashboard or run `netlify deploy --prod --deploy-id <previous-id>`.
- **Supabase functions:** redeploy the last known good version via `supabase functions deploy <name> --project-ref <project> --version <tag>`.
- **Environment variables:** store current production values securely (Netlify UI + Supabase dashboard) so they can be restored quickly.

## Observability tips

- Netlify deploy logs are accessible via `netlify open:deploy --prod`.
- Supabase function logs stream from `supabase functions logs server --project-ref <project>`.
- Consider wiring status notifications using Netlify build hooks and Supabase function webhooks.
